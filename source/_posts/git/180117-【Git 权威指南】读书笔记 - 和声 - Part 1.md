---
title: 【Git 权威指南】读书笔记 - 和声 - Part 1
permalink: got-git-reading-notes-harmony-part1
date: 2018-01-17 19:00:00
updatetime: 2018-01-17 19:00:00
comments: true
toc: true
tags:
   - git
description:
---

主要内容：【Git 协议与工作协同】、【冲突解决】、【Git 里程碑】

## Git 协议与工作协同

### Git 支持的协议

SSH、GIT、HTTP、HTTPS、FTP、FTPS、RSYNC 及前面已经看到的本地协议。

SSH 协议：

```
ssh://[user@]example.com[:port]/path/to/repo.git/

[user@]example.com:path/to/repo.git/
```

GIT 协议，最常用的只读协议：

```
git://example.com[:port]/path/to/repo.git/
```

HTTP[S] 协议：

```
http[s]://example.com[:port]/path/to/repo.git/
```

<!-- more -->

### 强制非快进式推送

```
$ git push -f
```

强制推送，会强制刷新服务器中的版本。

### 禁止非快进式推送

```
$ git --git-dir=/path/to/repos/shared.git config receive.denyNonFastForwards true
```

## 冲突解决

### 拉回操作中的合并

```
git pull = git fetch + git merge
```

### 合并策略

> [Merge Strategis](https://git-scm.com/docs/git-merge#_merge_strategies)

Git 合并操作支持很多合并策略，默认会选择最适合的合并策略。例如，和一个分支进行合并时会选择 recursive 合并策略，当和两个或两个以上的其他分支进行合并时采用 octopus 合并策略。

```
git merge [-s <strategy>] [-X <strategy-option>] [<commit>...]
```

This option forces conflicting hunks to be auto-resolved cleanly by favoring our version.

```
$ git merge -s recursive -X ours [<commit>...]
```

Merge branch obsolete into the current branch, using ours merge strategy:

```
$ git merge -s ours obsolete
```

## Git 里程碑

### 显示里程碑

```
$ git tag
```

显示说明。`-n<num>` 显示最多 `<num>` 行里程碑的说明：

```
$ git tag -n1
```

使用统配：

```
$ git tag -l v1.*
```

查看提交对应的里程碑及其他引用：

```
$ git log --oneline --decorate
```

### 创建里程碑

当创建了里程碑 mytag 后，会在版本库的 .git/refs/tags 目录下创建一个新文件。实际上指向的是一个提交：

```
$ git tag mytag

$ git cat-file -t mytag
commit
```

带说明的 tag 指向的不再是一个提交，而是一个 tag 对象：

```
$ git tag -m "My first annotated tag." mytag2

$ git cat-file -t mytag2
tag
```

为里程碑对象添加 GnuPG 签名：

```
$ git tag -s -m "My first GPG-signed tag." mytag3

```

### 删除里程碑

```
$ git tag -d mytag
Deleted tag 'mytag' (was 60a2f4f)
```

### 共享里程碑

创建的里程碑，默认只在本地版本库中可见，不会因为对分支执行推送而将里程碑也推送到远程版本库。

将 mytag 里程碑共享到上游版本库：

```
$ git push origin mytag
```

所有里程碑全部推送到远程版本库：

```
$ git push origin refs/tags/*
```

- 里程碑共享，必须显式的推送。
- 执行获取或拉回操作，自动从远程版本库获取新里程碑，并在本地版本库中创建。
- 如果本地已有同名的里程碑，默认不会从上游同步里程碑，即使两者里程碑的指向是不同的。

### 删除远程版本库的里程碑

```
$ git push origin :mytag2
```

### 里程碑命名规范

[语义化版本 2.0.0](https://semver.org/lang/zh-CN/)

版本格式：主版本号.次版本号.修订号，版本号递增规则如下：

- 主版本号：当你做了不兼容的 API 修改，
- 次版本号：当你做了向下兼容的功能性新增，
- 修订号：当你做了向下兼容的问题修正。

先行版本号及版本编译信息可以加到 `主版本号.次版本号.修订号` 的后面，作为延伸。

> Reference:
> - [3. Git和声 &mdash; GotGit](http://www.worldhello.net/gotgit/03-git-harmony)
